<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Decentralized Casino - Web3 Gaming</title>
  <meta name="description" content="Play provably fair casino games on the blockchain. 50/50 odds, 5% house edge, instant payouts." />
  <style>
    *,*::before,*::after{box-sizing:border-box}
    :root{
      --neon-purple:#a855f7;--neon-pink:#ec4899;--neon-cyan:#06b6d4;--neon-gold:#fbbf24;
      --dark:#0a0a0f;--darker:#050508;--card-bg:rgba(20,20,30,.8);
      --glass:rgba(255,255,255,.05);--glass-border:rgba(255,255,255,.1)
    }
    html{scroll-behavior:smooth}
    body{
      margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,sans-serif;
      background:radial-gradient(circle at 50% 0%,#1a0a2e 0%,var(--darker) 50%,var(--dark) 100%);
      color:#fff;line-height:1.6;min-height:100vh;overflow-x:hidden;position:relative
    }
    body::before{
      content:"";position:fixed;inset:0;
      background:url('data:image/svg+xml,<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg"><rect fill="%23a855f7" opacity=".02" x="0" y="0" width="50" height="50"/><rect fill="%23ec4899" opacity=".02" x="50" y="50" width="50" height="50"/></svg>');
      pointer-events:none;z-index:0
    }

    /* Animated background */
    .bg-orbs{position:fixed;inset:0;z-index:0;overflow:hidden;pointer-events:none}
    .orb{position:absolute;border-radius:50%;filter:blur(80px);opacity:.4;animation:float 20s ease-in-out infinite}
    .orb-1{width:400px;height:400px;background:var(--neon-purple);top:10%;left:10%;animation-delay:0s}
    .orb-2{width:300px;height:300px;background:var(--neon-pink);bottom:20%;right:15%;animation-delay:5s}
    .orb-3{width:350px;height:350px;background:var(--neon-cyan);top:50%;left:50%;animation-delay:10s}
    @keyframes float{0%,100%{transform:translate(0,0) scale(1)}33%{transform:translate(30px,-30px) scale(1.1)}66%{transform:translate(-20px,20px) scale(.9)}}

    /* Container */
    .container{max-width:1200px;margin:0 auto;padding:0 20px;position:relative;z-index:1}

    /* Header/Nav */
    header{padding:20px 0;position:sticky;top:0;z-index:100;backdrop-filter:blur(20px);background:rgba(10,10,15,.8);border-bottom:1px solid var(--glass-border)}
    nav{display:flex;justify-content:space-between;align-items:center;max-width:1200px;margin:0 auto;padding:0 20px}
    .logo{font-size:1.8rem;font-weight:800;background:linear-gradient(135deg,var(--neon-purple),var(--neon-pink));-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent;text-decoration:none}
    .nav-links{display:flex;gap:30px;list-style:none;margin:0}
    .nav-links a{color:#fff;text-decoration:none;font-weight:600;transition:color .3s;-webkit-tap-highlight-color:transparent}
    .nav-links a:hover{color:var(--neon-purple)}
    .connect-btn{padding:12px 28px;background:linear-gradient(135deg,var(--neon-purple),var(--neon-pink));border:none;border-radius:999px;color:#fff;font-weight:700;cursor:pointer;transition:transform .2s,box-shadow .2s;-webkit-tap-highlight-color:transparent}
    .connect-btn:hover{transform:translateY(-2px);box-shadow:0 20px 40px rgba(168,85,247,.4)}
    .connect-btn:active{transform:scale(.98)}

    /* Hero */
    .hero{min-height:80vh;display:flex;align-items:center;justify-content:center;text-align:center;padding:100px 20px 80px}
    .hero-content{max-width:900px}
    .hero-title{font-size:clamp(2.5rem,7vw,5rem);font-weight:900;margin:0 0 20px;line-height:1.1}
    .hero-title .gradient{background:linear-gradient(135deg,var(--neon-purple),var(--neon-pink),var(--neon-cyan));-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent;animation:glow 3s ease-in-out infinite alternate}
    @keyframes glow{from{filter:drop-shadow(0 0 20px rgba(168,85,247,.5))}to{filter:drop-shadow(0 0 40px rgba(236,72,153,.5))}}
    .hero-subtitle{font-size:1.3rem;color:#cbd5e1;margin:0 0 40px;font-weight:400}
    .cta-group{display:flex;gap:20px;justify-content:center;flex-wrap:wrap}
    .cta-primary{padding:16px 40px;background:linear-gradient(135deg,var(--neon-purple),var(--neon-pink));border:none;border-radius:999px;color:#fff;font-weight:700;font-size:1.1rem;cursor:pointer;transition:transform .2s,box-shadow .2s;text-decoration:none;display:inline-block;-webkit-tap-highlight-color:transparent}
    .cta-primary:hover{transform:translateY(-3px);box-shadow:0 25px 50px rgba(168,85,247,.5)}
    .cta-primary:active{transform:scale(.98)}
    .cta-secondary{padding:16px 40px;background:transparent;border:2px solid var(--neon-cyan);border-radius:999px;color:var(--neon-cyan);font-weight:700;font-size:1.1rem;cursor:pointer;transition:all .2s;text-decoration:none;display:inline-block;-webkit-tap-highlight-color:transparent}
    .cta-secondary:hover{background:var(--neon-cyan);color:var(--dark);transform:translateY(-3px)}
    .cta-secondary:active{transform:scale(.98)}

    /* Stats */
    .stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin:60px 0}
    .stat-card{background:var(--card-bg);backdrop-filter:blur(20px);border:1px solid var(--glass-border);border-radius:20px;padding:30px;text-align:center;transition:transform .3s,box-shadow .3s}
    .stat-card:hover{transform:translateY(-5px);box-shadow:0 20px 40px rgba(168,85,247,.3)}
    .stat-number{font-size:2.5rem;font-weight:800;background:linear-gradient(135deg,var(--neon-gold),var(--neon-pink));-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent;margin:0 0 10px}
    .stat-label{color:#94a3b8;font-size:1rem}

    /* Game Section */
    .game-section{padding:80px 0;text-align:center}
    .section-title{font-size:clamp(2rem,5vw,3.5rem);font-weight:800;margin:0 0 20px;background:linear-gradient(135deg,#fff,var(--neon-purple));-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent}
    .section-subtitle{color:#94a3b8;font-size:1.2rem;margin:0 0 60px}

    /* Game Card */
    .game-card{background:var(--card-bg);backdrop-filter:blur(20px);border:1px solid var(--glass-border);border-radius:30px;padding:50px;max-width:600px;margin:0 auto;position:relative;overflow:hidden}
    .game-card::before{content:"";position:absolute;top:0;left:0;right:0;height:4px;background:linear-gradient(90deg,var(--neon-purple),var(--neon-pink),var(--neon-cyan))}
    .bet-amount{font-size:3rem;font-weight:800;color:var(--neon-gold);margin:20px 0}
    .bet-controls{display:flex;gap:15px;justify-content:center;margin:30px 0;flex-wrap:wrap}
    .bet-btn{padding:12px 24px;background:var(--glass);border:1px solid var(--glass-border);border-radius:999px;color:#fff;font-weight:700;cursor:pointer;transition:all .2s;-webkit-tap-highlight-color:transparent}
    .bet-btn:hover{background:var(--neon-purple);border-color:var(--neon-purple);transform:translateY(-2px)}
    .bet-btn:active{transform:scale(.95)}
    .play-btn{width:200px;height:200px;border-radius:50%;background:linear-gradient(135deg,var(--neon-purple),var(--neon-pink));border:none;color:#fff;font-size:1.5rem;font-weight:800;cursor:pointer;transition:transform .2s,box-shadow .2s;margin:30px auto;display:block;position:relative;-webkit-tap-highlight-color:transparent}
    .play-btn::before{content:"";position:absolute;inset:-5px;border-radius:50%;background:linear-gradient(135deg,var(--neon-purple),var(--neon-pink));filter:blur(20px);opacity:.5;z-index:-1}
    .play-btn:hover{transform:scale(1.05);box-shadow:0 30px 60px rgba(168,85,247,.6)}
    .play-btn:active{transform:scale(.98)}
    .play-btn:disabled{opacity:.5;cursor:not-allowed;transform:none}
    .game-info{color:#94a3b8;font-size:.9rem;margin:20px 0}
    .result{font-size:1.5rem;font-weight:700;margin:20px 0;min-height:40px}
    .result.win{color:var(--neon-cyan);animation:pulse .5s}
    .result.lose{color:var(--neon-pink)}
    @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}

    /* Winners */
    .winners-section{padding:60px 0}
    .winners-list{display:flex;flex-direction:column;gap:15px;max-width:600px;margin:0 auto}
    .winner-card{background:var(--card-bg);backdrop-filter:blur(20px);border:1px solid var(--glass-border);border-radius:15px;padding:20px;display:flex;justify-content:space-between;align-items:center}
    .winner-address{font-family:monospace;color:var(--neon-cyan)}
    .winner-amount{color:var(--neon-gold);font-weight:700}

    /* Features */
    .features{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:30px;padding:60px 0}
    .feature-card{background:var(--card-bg);backdrop-filter:blur(20px);border:1px solid var(--glass-border);border-radius:20px;padding:40px;text-align:center;transition:transform .3s}
    .feature-card:hover{transform:translateY(-8px)}
    .feature-icon{font-size:3rem;margin:0 0 20px}
    .feature-title{font-size:1.5rem;font-weight:700;margin:0 0 15px}
    .feature-description{color:#94a3b8;line-height:1.6}

    /* Footer */
    footer{text-align:center;padding:40px 20px;border-top:1px solid var(--glass-border);color:#64748b;margin-top:100px}
    .footer-links{display:flex;gap:30px;justify-content:center;margin:20px 0;flex-wrap:wrap}
    .footer-links a{color:#94a3b8;text-decoration:none;transition:color .3s}
    .footer-links a:hover{color:var(--neon-purple)}

    /* Status message */
    .status-message{margin:20px 0;padding:15px;border-radius:10px;font-weight:600}
    .status-message.info{background:rgba(6,182,212,.1);border:1px solid var(--neon-cyan);color:var(--neon-cyan)}
    .status-message.error{background:rgba(236,72,153,.1);border:1px solid var(--neon-pink);color:var(--neon-pink)}
    .status-message.success{background:rgba(34,197,94,.1);border:1px solid #22c55e;color:#22c55e}

    /* Responsive */
    @media (max-width:768px){
      .nav-links{display:none}
      .stats{grid-template-columns:1fr}
      .cta-group{flex-direction:column;align-items:center}
      .play-btn{width:160px;height:160px;font-size:1.2rem}
    }

    /* Motion safety */
    @media (prefers-reduced-motion: reduce){
      *{animation:none!important;transition:none!important}
      .bg-orbs{display:none}
    }
  </style>
</head>
<body>
  <div class="bg-orbs" aria-hidden="true">
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>
    <div class="orb orb-3"></div>
  </div>

  <header>
    <nav>
      <a href="#" class="logo">üé∞ DecentraCasino</a>
      <ul class="nav-links">
        <li><a href="#game">Play</a></li>
        <li><a href="#features">Features</a></li>
        <li><a href="#winners">Winners</a></li>
      </ul>
      <button class="connect-btn" id="connectBtn">Connect Wallet</button>
    </nav>
  </header>

  <main>
    <!-- Hero -->
    <section class="hero">
      <div class="hero-content">
        <h1 class="hero-title">
          Win Big on the <span class="gradient">Blockchain</span>
        </h1>
        <p class="hero-subtitle">Provably fair gaming. 50/50 odds. Instant payouts. Powered by Ethereum.</p>
        <div class="cta-group">
          <a href="#game" class="cta-primary">Play Now</a>
          <a href="#features" class="cta-secondary">Learn More</a>
        </div>
      </div>
    </section>

    <!-- Stats -->
    <div class="container">
      <div class="stats">
        <div class="stat-card">
          <div class="stat-number">50%</div>
          <div class="stat-label">Win Rate</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">5%</div>
          <div class="stat-label">House Edge</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">0.01 ETH</div>
          <div class="stat-label">Min Bet</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">1 ETH</div>
          <div class="stat-label">Max Bet</div>
        </div>
      </div>
    </div>

    <!-- Game Section -->
    <section id="game" class="game-section">
      <div class="container">
        <h2 class="section-title">Place Your Bet</h2>
        <p class="section-subtitle">Double your money with 50/50 odds</p>
        
        <div class="game-card">
          <div class="status-message info" id="statusMessage">Connect your wallet to start playing</div>
          
          <div class="bet-amount" id="betAmount">0.01 ETH</div>
          
          <div class="bet-controls">
            <button class="bet-btn" onclick="updateBet(0.01)">0.01 ETH</button>
            <button class="bet-btn" onclick="updateBet(0.05)">0.05 ETH</button>
            <button class="bet-btn" onclick="updateBet(0.1)">0.1 ETH</button>
            <button class="bet-btn" onclick="updateBet(0.5)">0.5 ETH</button>
            <button class="bet-btn" onclick="updateBet(1)">1 ETH</button>
          </div>
          
          <button class="play-btn" id="playBtn" disabled>
            SPIN TO WIN
          </button>
          
          <div class="result" id="result"></div>
          
          <div class="game-info">
            <p>üé≤ Each bet has a 50% chance to double your money (minus 5% house edge)</p>
            <p>‚ö° Two transactions required: one to place bet, one to reveal result</p>
            <p>üîí Results are provably fair using blockchain randomness</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Winners -->
    <section id="winners" class="winners-section">
      <div class="container">
        <h2 class="section-title">Recent Winners üèÜ</h2>
        <div class="winners-list" id="winnersList">
          <div class="winner-card">
            <span class="winner-address">0x742d...89Ab</span>
            <span class="winner-amount">+0.95 ETH</span>
          </div>
          <div class="winner-card">
            <span class="winner-address">0x1a2b...3c4d</span>
            <span class="winner-amount">+0.475 ETH</span>
          </div>
          <div class="winner-card">
            <span class="winner-address">0x5e6f...7g8h</span>
            <span class="winner-amount">+0.19 ETH</span>
          </div>
        </div>
      </div>
    </section>

    <!-- Features -->
    <section id="features">
      <div class="container">
        <h2 class="section-title">Why Choose Us</h2>
        <div class="features">
          <div class="feature-card">
            <div class="feature-icon">üîê</div>
            <h3 class="feature-title">Provably Fair</h3>
            <p class="feature-description">Every game outcome is verifiable on-chain. No trust required, only math.</p>
          </div>
          <div class="feature-card">
            <div class="feature-icon">‚ö°</div>
            <h3 class="feature-title">Instant Payouts</h3>
            <p class="feature-description">Winnings are automatically sent to your wallet. No waiting, no KYC.</p>
          </div>
          <div class="feature-card">
            <div class="feature-icon">üõ°Ô∏è</div>
            <h3 class="feature-title">Fully Decentralized</h3>
            <p class="feature-description">Smart contract controlled. No central authority can interfere with games.</p>
          </div>
          <div class="feature-card">
            <div class="feature-icon">üíé</div>
            <h3 class="feature-title">Low House Edge</h3>
            <p class="feature-description">Only 5% house edge means better odds than traditional casinos.</p>
          </div>
          <div class="feature-card">
            <div class="feature-icon">üåê</div>
            <h3 class="feature-title">Global Access</h3>
            <p class="feature-description">Play from anywhere in the world with just a crypto wallet.</p>
          </div>
          <div class="feature-card">
            <div class="feature-icon">üîç</div>
            <h3 class="feature-title">Transparent</h3>
            <p class="feature-description">All transactions and game history visible on the blockchain.</p>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div class="container">
      <div class="footer-links">
        <a href="#">Documentation</a>
        <a href="#">Smart Contract</a>
        <a href="#">GitHub</a>
        <a href="#">Discord</a>
      </div>
      <p>&copy; 2025 DecentraCasino. Built on Ethereum.</p>
      <p style="font-size:.85rem;color:#475569;margin-top:10px">‚ö†Ô∏è Gambling involves risk. Play responsibly.</p>
    </div>
  </footer>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
  <script>
    // CONTRACT CONFIGURATION - UPDATE THESE VALUES
    const CONTRACT_ADDRESS = '0xYourContractAddressHere'; // Replace with your deployed contract address
    const CONTRACT_ABI = [
      "function playGame() external payable",
      "function getLastThreeWinners() external view returns (address[] memory)",
      "function gameWeiValues(address) external view returns (uint256)",
      "function blockNumbersToBeUsed(address) external view returns (uint256)",
      "event GameStarted(address indexed player, uint256 amount, uint256 revealBlock)",
      "event GameResult(address indexed player, bool won, uint256 amount)"
    ];

    let currentBet = 0.01;
    let provider = null;
    let signer = null;
    let contract = null;
    let userAddress = null;
    let gameActive = false;

    // Update bet amount
    function updateBet(amount) {
      currentBet = amount;
      document.getElementById('betAmount').textContent = amount + ' ETH';
    }

    // Show status message
    function showStatus(message, type = 'info') {
      const statusEl = document.getElementById('statusMessage');
      statusEl.textContent = message;
      statusEl.className = `status-message ${type}`;
    }

    // Format address for display
    function formatAddress(address) {
      return address.slice(0, 6) + '...' + address.slice(-4);
    }

    // Load recent winners
    async function loadWinners() {
      if (!contract) return;
      
      try {
        const winners = await contract.getLastThreeWinners();
        const winnersList = document.getElementById('winnersList');
        
        if (winners.length === 0) {
          winnersList.innerHTML = '<p style="text-align:center;color:#64748b">No winners yet. Be the first!</p>';
          return;
        }
        
        winnersList.innerHTML = '';
        winners.forEach(winner => {
          if (winner !== '0x0000000000000000000000000000000000000000') {
            const card = document.createElement('div');
            card.className = 'winner-card';
            card.innerHTML = `
              <span class="winner-address">${formatAddress(winner)}</span>
              <span class="winner-amount">üèÜ Winner</span>
            `;
            winnersList.appendChild(card);
          }
        });
      } catch (error) {
        console.error('Error loading winners:', error);
      }
    }

    // Check if user has active game
    async function checkActiveGame() {
      if (!contract || !userAddress) return false;
      
      try {
        const blockNumber = await contract.blockNumbersToBeUsed(userAddress);
        return blockNumber > 0;
      } catch (error) {
        console.error('Error checking active game:', error);
        return false;
      }
    }

    // Connect wallet
    document.getElementById('connectBtn').addEventListener('click', async () => {
      if (typeof window.ethereum === 'undefined') {
        showStatus('Please install MetaMask to play!', 'error');
        window.open('https://metamask.io/download/', '_blank');
        return;
      }

      try {
        // Request account access
        provider = new ethers.BrowserProvider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = await provider.getSigner();
        userAddress = await signer.getAddress();
        
        // Initialize contract
        contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
        
        // Update UI
        document.getElementById('connectBtn').textContent = formatAddress(userAddress);
        document.getElementById('playBtn').disabled = false;
        
        // Check if user has active game
        const hasActiveGame = await checkActiveGame();
        if (hasActiveGame) {
          showStatus('You have an active game! Click REVEAL RESULT to see if you won.', 'info');
          document.getElementById('playBtn').textContent = 'REVEAL RESULT';
        } else {
          showStatus('Wallet connected! Select your bet and play.', 'success');
        }
        
        // Load winners
        await loadWinners();
        
      } catch (error) {
        showStatus('Failed to connect wallet: ' + error.message, 'error');
      }
    });

    // Play game
    document.getElementById('playBtn').addEventListener('click', async () => {
      if (!userAddress || !contract) {
        showStatus('Please connect your wallet first!', 'error');
        return;
      }

      if (gameActive) {
        showStatus('Please wait for current transaction to complete...', 'info');
        return;
      }

      const playBtn = document.getElementById('playBtn');
      const resultEl = document.getElementById('result');
      
      try {
        gameActive = true;
        playBtn.disabled = true;
        resultEl.textContent = '';
        resultEl.className = 'result';

        // Check if user has active game
        const hasActiveGame = await checkActiveGame();
        
        if (!hasActiveGame) {
          // First transaction: Place bet
          showStatus('Transaction 1/2: Placing bet... Confirm in MetaMask', 'info');
          
          const betWei = ethers.parseEther(currentBet.toString());
          const tx = await contract.playGame({ value: betWei });
          
          showStatus('Waiting for transaction confirmation...', 'info');
          resultEl.textContent = '‚è≥ Processing...';
          
          await tx.wait();
          
          showStatus('Bet placed! Wait for next block, then click REVEAL RESULT', 'success');
          resultEl.textContent = '‚úÖ Bet placed! Now reveal your result';
          playBtn.textContent = 'REVEAL RESULT';
          playBtn.disabled = false;
          
        } else {
          // Second transaction: Reveal result
          showStatus('Transaction 2/2: Revealing result... Confirm in MetaMask', 'info');
          resultEl.textContent = 'üé≤ Revealing...';
          
          const tx = await contract.playGame({ value: 0 });
          
          showStatus('Waiting for result...', 'info');
          
          const receipt = await tx.wait();
          
          // Parse events to get result
          let won = false;
          let winAmount = 0;
          
          for (const log of receipt.logs) {
            try {
              const parsed = contract.interface.parseLog(log);
              if (parsed && parsed.name === 'GameResult') {
                won = parsed.args.won;
                winAmount = parsed.args.amount;
                break;
              }
            } catch (e) {
              // Skip unparseable logs
            }
          }
          
          if (won) {
            const winAmountEth = ethers.formatEther(winAmount);
            resultEl.textContent = `üéâ YOU WON ${parseFloat(winAmountEth).toFixed(4)} ETH!`;
            resultEl.className = 'result win';
            showStatus(`Congratulations! You won ${parseFloat(winAmountEth).toFixed(4)} ETH`, 'success');
          } else {
            resultEl.textContent = `üíî Better luck next time`;
            resultEl.className = 'result lose';
            showStatus(`You lost ${currentBet} ETH. Try again!`, 'error');
          }
          
          playBtn.textContent = 'SPIN TO WIN';
          
          // Reload winners
          await loadWinners();
        }

      } catch (error) {
        console.error('Game error:', error);
        
        if (error.code === 4001) {
          showStatus('Transaction rejected by user', 'error');
        } else if (error.message.includes('InsufficientContractBalance')) {
          showStatus('Casino has insufficient balance. Try a smaller bet.', 'error');
        } else if (error.message.includes('InvalidBetAmount')) {
          showStatus('Invalid bet amount. Must be between 0.01 and 1 ETH.', 'error');
        } else if (error.message.includes('TooEarly')) {
          showStatus('Too early! Wait for the next block before revealing.', 'error');
        } else if (error.message.includes('TooLate')) {
          showStatus('Too late! The block is too old. Starting new game...', 'error');
          playBtn.textContent = 'SPIN TO WIN';
        } else {
          showStatus('Error: ' + (error.reason || error.message), 'error');
        }
        
        resultEl.textContent = '';
      } finally {
        gameActive = false;
        playBtn.disabled = false;
      }
    });

    // Auto-detect if wallet already connected
    window.addEventListener('load', async () => {
      if (typeof window.ethereum !== 'undefined') {
        try {
          provider = new ethers.BrowserProvider(window.ethereum);
          const accounts = await provider.listAccounts();
          
          if (accounts.length > 0) {
            signer = await provider.getSigner();
            userAddress = await signer.getAddress();
            contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
            
            document.getElementById('connectBtn').textContent = formatAddress(userAddress);
            document.getElementById('playBtn').disabled = false;
            
            const hasActiveGame = await checkActiveGame();
            if (hasActiveGame) {
              showStatus('You have an active game! Click REVEAL RESULT to see if you won.', 'info');
              document.getElementById('playBtn').textContent = 'REVEAL RESULT';
            } else {
              showStatus('Wallet connected! Select your bet and play.', 'success');
            }
            
            await loadWinners();
          }
        } catch (error) {
          console.error('Auto-connect error:', error);
        }
      }
    });

    // Listen for account changes
    if (typeof window.ethereum !== 'undefined') {
      window.ethereum.on('accountsChanged', (accounts) => {
        if (accounts.length === 0) {
          userAddress = null;
          contract = null;
          document.getElementById('connectBtn').textContent = 'Connect Wallet';
          document.getElementById('playBtn').disabled = true;
          showStatus('Wallet disconnected', 'info');
        } else {
          location.reload();
        }
      });

      window.ethereum.on('chainChanged', () => {
        location.reload();
      });
    }
  </script>
</body>
</html>